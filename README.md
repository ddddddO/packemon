# PackÃ©mon

Packet monster, or `PackÃ©mon` for short! (ã£â€˜-â€™)â•®=ÍÍŸÍŸÍâ—’ ãƒ½( '-'ãƒ½) <br>

![](./assets/packemon.gif)


TUI tool and Go library for generating packets of arbitrary input and monitoring packets on any network interfaces (default: `eth0`). **This tool is not available for Windows and macOS. I have confirmed that it works on Debian on WSL2.**<br>

I intend to develop it patientlyğŸŒ´

## Feature

This TUI tool has two major functions: packet generation and packet monitoring.

![](./assets/tui_gen_mon_1.png)
![](./assets/tui_gen_mon_2.png)

This image shows packemon running in Generator / Monitor mode.</br>
DNS query packet generated by Generator on the left is shown in 27st line of the Monitor. DNS query response packet is shown as 28nd line, and a more detailed view of it is shown in the image below.

Packemon's Monitor allows user to select each packet by pressing `Enter` key. Then, select any line and press `Enter` key to see the details of the desired packet. Pressing `Esc` key in the packet detail screen will return you to the original packet list screen.

### Packet Generator

>[!WARNING]
> While using Generator mode, TCP RST packets automatically sent out by the kernel are dropped. When this mode is stopped, the original state is restored.
> Incidentally, dropping RST packets is done by running [the eBPF program](./egress_control/).

- [x] Send generated packets to any network interfaces.
  - You can specify network interface with `--interface` flag. Default is `eth0`.

- The following types of packets are covered.
  - [x] Ethernet
  - [x] ARP (WIP)
  - [x] IPv4 (WIP)
  - [x] ICMP (WIP)
  - [x] TCP (WIP)
  - [x] UDP (WIP)
  - [ ] TLSv1.2 (WIP)
    - [Currently there is only debug mode](./cmd/debugging/tls-server/README.md)
      - TCP 3way handshake ~ TLS handshake ~ TLS Application data
  - [x] DNS (WIP)
  - [x] HTTP (WIP)
  - [ ] xxxxx....

### Packet Monitor

- [x] Monitor any network interfaces.
  - You can specify network interface with `--interface` flag. Default is `eth0`.

- The following types of packets are covered.
  - [x] Ethernet
  - [x] ARP
  - [x] IPv4 (WIP)
  - [x] ICMP (WIP)
  - [x] TCP (WIP)
  - [x] UDP
  - [ ] DNS (WIP)
    - [x] DNS query
    - [x] DNS query response
    - [ ] xxxxx....
  - [ ] HTTP (WIP)
    - [x] HTTP GET request
    - [x] HTTP GET response
    - [ ] xxxxx....
  - [ ] xxxxx....

## Installation

<pre>
<b>Go</b>
$ go install github.com/ddddddO/packemon/cmd/packemon@latest

<b>deb</b>
$ export PACKEMON_VERSION=X.X.X
$ curl -o packemon.deb -L https://github.com/ddddddO/packemon/releases/download/v$PACKEMON_VERSION/packemon_$PACKEMON_VERSION-1_amd64.deb
$ dpkg -i packemon.deb

<b>rpm</b>
$ export PACKEMON_VERSION=X.X.X
$ yum install https://github.com/ddddddO/packemon/releases/download/v$PACKEMON_VERSION/packemon_$PACKEMON_VERSION-1_amd64.rpm

<b>apk</b>
$ export PACKEMON_VERSION=X.X.X
$ curl -o packemon.apk -L https://github.com/ddddddO/packemon/releases/download/v$PACKEMON_VERSION/packemon_$PACKEMON_VERSION-1_amd64.apk
$ apk add --allow-untrusted packemon.apk

</pre>

## Usage

- Packet Generator
  ```console
  sudo packemon --send
  ```

- Packet Monitor
  ```console
  sudo packemon
  ```

## Another feature

The local node's browser can monitor packets from remote nodes or send arbitrary packets from remote nodes.

```
                                         +-------------------------------------+
+----------------------+                 | REMOTE NODE                         |
| LOCAL NODE (Browser) |                 | $ sudo packemon-api --interface xxx |
|  Monitor   <---------|-- WebSocket   --|--> HTTP GET  /ws  <-----+           |
|  Generator  ---------|-- POST packet --|--> HTTP POST /packet    |           |
+----------------------+                 |      -> parse packet    |           |                  +---------------+
                                         |           -> Network Interface -----|-- Send packet -->| TARGET NODE x |
                                         +-------------------------------------+                  |               |
                                                                                                  +---------------+
```

- Remote node
  ![](./assets/packemon_api_remote.png)

- Local node
  ![](./assets/packemon_api_local.png)


>[!WARNING]
> Please note that the following is dangerous.

The following procedure is an example of how you can expose packemon-api to the outside world and monitor and send remote node packets on your browser.

1. (REMOTE) Please install `packemon-api` and run.
    ```console
    $ go install github.com/ddddddO/packemon/cmd/packemon-api@latest
    $ sudo packemon-api --interface wlan0
    ```
1. (REMOTE) Run [`ngrok`](https://ngrok.com/) and note the URL to be paid out.
    ```console
    $ ngrok http 8082
    ```
1. (LOCAL) Enter the dispensed URL into your browser and you will be able to monitor and send packets to remote node.

## Related tools
- netcat
- [Nmap](https://nmap.org/)
- [Scapy](https://github.com/secdev/scapy)
- [google/gopacket](https://github.com/google/gopacket)

## Acknowledgment
- [rivo/tview](https://github.com/rivo/tview)
  - Packemon is using this TUI library.

- [Golangã§ä½œã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ«ãƒ¼ã‚¿](https://booth.pm/ja/items/5290391)
  - The way Go handles syscalls, packet checksum logic, etc. was helpful. This is a book in Japanese.


## Log (japanese)

<details><summary>xxx</summary>

## Links
- ã€ŒGolangã§ä½œã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ«ãƒ¼ã‚¿ã€
  - ãã®å®Ÿè£…ã‚³ãƒ¼ãƒ‰: https://github.com/sat0ken/go-curo
- https://terassyi.net/posts/2020/03/29/ethernet.html
- å‹•ä½œç¢ºèªç”¨ã‚³ãƒãƒ³ãƒ‰ã®å‚è€ƒ
  - https://zenn.dev/takai404/articles/76d47e944d8e18
- [Scrapboxãƒ¡ãƒ¢æ›¸ã](https://scrapbox.io/ddddddo/%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E7%B3%BB%E8%AA%AD%E3%81%BF%E7%89%A9)

- WSL2ã®Debianã§å‹•ä½œã—ãŸã€‚

- ä»»æ„ã® Ethernet ãƒ˜ãƒƒãƒ€ / IPv4 ãƒ˜ãƒƒãƒ€ / ARP / ICMP ã‚’æ¥½ã«ä½œã‚Œã¦ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é€ä¿¡ã§ãã‚‹
- ä»¥ä¸‹ã¯tmuxã§3åˆ†å‰²ã—ãŸç”»é¢ã«å„ç¨®ãƒ˜ãƒƒãƒ€ã®ãƒ•ã‚©ãƒ¼ãƒ ç”»é¢ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ã€‚ãã—ã¦ ICMP echo request ã‚’é€ä¿¡ã—ã€ echo reply ãŒè¿”ã£ã¦ãã¦ã„ã‚‹ã“ã¨ã‚’ Wireshark ã§ç¢ºèªã—ãŸæ§˜å­
  ![](./assets/tui_ether_ip_icmp.png)
  ![](./assets/tui_send_icmp_result1.png)
  ![](./assets/tui_send_icmp_result2.png)

- ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’å—ä¿¡ã—ã¦è©³ç´°è¡¨ç¤ºï¼ˆARPã¨IPv4ï¼‰
  ![](./assets/tui_send_recieve.png)

  <details><summary>å°‘ã—å‰ã®UIï¼ˆ`5062561` ã®ã‚³ãƒŸãƒƒãƒˆï¼‰</summary>

  ![](./assets/tui_0428.png)
  ![](./assets/tui_cap_0428.png)

  </details>

- TUIãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦ https://github.com/rivo/tview ã‚’ä½¿ã‚ã›ã¦ã‚‚ã‚‰ã£ã¦ã‚‹ğŸ™‡

### å‹•ä½œç¢ºèª

#### Raspberry Piã§ç°¡æ˜“http server
```console
pi@raspberrypi:~ $ sudo go run main.go
```

#### ãƒ‘ã‚±ãƒƒãƒˆã‚­ãƒ£ãƒ—ãƒãƒ£
```console
$ sudo tcpdump -U -i eth0 -w - | /mnt/c/Program\ Files/Wireshark/Wireshark.exe -k -i -
```

- å—ä¿¡ç”»é¢

  ```console
  $ sudo go run cmd/packemon/main.go
  ```


- é€ä¿¡ç”»é¢

  ```console
  $ sudo go run cmd/packemon/main.go --send
  ```

- å˜ç™ºãƒ•ãƒ¬ãƒ¼ãƒ é€ä¿¡ã‚³ãƒãƒ³ãƒ‰ï¼ˆe.g. ARP requestï¼‰

  ```console
  $ sudo go run cmd/packemon/main.go --debug --send --proto arp
  ```

#### æ‰‹è»½ã«ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
```console
$ arping -c 1 1.2.3.4
ARPING 1.2.3.4 from 172.23.242.78 eth0
Sent 1 probes (1 broadcast(s))
Received 0 response(s)
```

#### tcpã§dns
```console
$ nslookup -vc github.com
```

#### ipv6ã§ping
ã©ã†ã™ã‚‹ã‹

```console
$ ip -6 route
$ ping -c 1 fe80::1
```

#### è‡ªå‰å®Ÿè£…ã® tcp 3way handshake
```console
$ sudo go run cmd/packemon/main.go --send --debug --proto tcp-3way-http
```

### å‹•ä½œç¢ºèªã®æ§˜å­

<details><summary>xxx</summary>

- Ethernetãƒ•ãƒ¬ãƒ¼ãƒ ã®ã¿ä½œã£ã¦é€ä¿¡ï¼ˆ`77c9149` ã§ã‚³ãƒŸãƒƒãƒˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼‰

  ![](./assets/Frame.png)

- ARPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œã£ã¦é€ä¿¡ï¼ˆ`390f266` ã§ã‚³ãƒŸãƒƒãƒˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ã€‚ä¸­èº«ã¯ã‚ã¡ã‚ƒãã¡ã‚ƒã¨æ€ã†ã‘ã©ï¼‰

  ![](./assets/ARP.png)

- ARPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ã¦ãƒ‘ãƒ¼ã‚¹ï¼ˆ`b6a025a` ã§ã‚³ãƒŸãƒƒãƒˆï¼‰

  ![](./assets/ARP_request_console.png)
  ![](./assets/ARP_request.png)

</details>
